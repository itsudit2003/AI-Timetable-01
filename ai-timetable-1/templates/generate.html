{% extends "base.html" %}
{% block title %}Generate Timetable{% endblock %}

{% block content %}
<h2>Generate Timetable</h2>
<form method="POST" class="row g-2 mb-3">
    <div class="col-md-4">
        <select class="form-select" name="course_id" required>
            <option value="">Select Course</option>
            {% for c in courses %}
            <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-4">
        <button class="btn btn-primary w-100">Generate Timetable</button>
    </div>
</form>

{% if timetable %}
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Day</th>
            <th>Section</th>
            <th>Subject</th>
            <th>Teacher</th>
            <th>Start</th>
            <th>End</th>
        </tr>
    </thead>
    <tbody>
        {% set day_names = ["Monday","Tuesday","Wednesday","Thursday","Friday"] %}
        {% macro format_time(t) %}
            {% set h, m = t.split(':') %}
            {% set h = h|int %}
            {% set m = m|int %}
            {% if h == 0 %}
                12:{{ "%02d"|format(m) }} AM
            {% elif h < 12 %}
                {{ h }}:{{ "%02d"|format(m) }} AM
            {% elif h==12 %}
                12:{{ "%02d"|format(m) }} PM
            {% else %}
                {{ h-12 }}:{{ "%02d"|format(m) }} PM
            {% endif %}
        {% endmacro %}
        {% for t in timetable %}
        <tr>
            <td>{{ day_names[t.day_of_week] if t.day_of_week is not none else t.day_of_week }}</td>
            <td>{{ t.section_name }}</td>
            <td>{{ t.subject_name }}</td>
            <td>{{ t.teacher_name }}</td>
            <td>{{ format_time(t.start_time_str) }}</td>
            <td>{{ format_time(t.end_time_str) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}
